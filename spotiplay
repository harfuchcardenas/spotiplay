#!/usr/bin/perl

use strict;  # Enforce strict variable declaration
use warnings; # Enable warnings for better debugging

# Print "Hello, World!" to the console
print "Hello, World!\n";
my $temp = '/../include';
my $current_directory = qx(pwd);
# Remove the newline character from the end of the output
chomp($current_directory);
$current_directory=$current_directory.$temp;

# Print the current directory path
print "Current directory: $current_directory\n";
# Specify the spotify_songs of your csv document with the list of songs currently been your favorites' songs on Spotify
my $spotify_songs = $current_directory.'/My Spotify Library.csv';
my @id;
my $id;
my $i = 0;

# Open the file for reading
open(my $fh, '<', $spotify_songs) or die "Could not open file '$spotify_songs' $!";
# Read the file line by line
while (my $line = <$fh>) {
    chomp($line);  # Remove the newline character at the end of the line
    # Split the line based on the specified character (comma in this case)
    my @strings = split(/,/, $line);
    # Print the separated strings
    my $songID = $strings[6];
    # print "songID: $songID\n";
    $id[$i]=$songID;
    $i++;
}

my @array = `ls ~/Musik`;
foreach my $line (@array) {
    chomp($line);
    #print "Gefundene Datei: $line\n";
}
my $ffmpeg_command =  "ffmpeg  -i 'David Guetta - Paris.mp3' -f ffmetadata metadata.txt -hide_banner";
# Capture the output of the ffmpeg command
my $output = `$ffmpeg_command`;
my $file = 'metadata.txt';
my $search_string = 'comment';
my @results;

open(my $fh2, '<', $file) or die "Cannot open file.";
while (my $line = <$fh2>) {
    if ($line =~ /\b\Q$search_string\E\b/){
        push @results, $line;
    }
}
my $comment = $results[0];
print "Results: \n\n$comment";
exit 0;
# Parse the comment from the ffmpeg output
if (my $output=~ /comment\s+:\s+(.*)/i){
    my $comment = $1;  # Capture the value after 'comment:'
    print "Extracted Comment: $comment\n";
} else {
    print "No comment field found in the string.\n";
}
exit 0;
# Close the file handle
close($fh);
my $spotifyURL;
my @spotifyURL;
my $URL = 'https://open.spotify.com/intl-de/track/';
for(my $i = 1; $i < $#id;$i++){
    push(@spotifyURL,$URL.$id[$i]);
}
my $func = 0;
foreach (@spotifyURL){
   my $hash =$_;
   $hash =~ tr/"//d;
   if(!system("spotdl download $hash")){
       next;
   }else{ my $i=0;
        while(!system("spotdl download $hash")){
            $i++;
            if ($i==25){
                 last;
            }else{ last;
            }
        }
    }
}

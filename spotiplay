#!/usr/bin/perl

use strict;  # Enforce strict variable declaration
use warnings; # Enable warnings for better debugging

# Print "Hello, World!" to the console
print "Hello, World!\n";
my $temp = '/../include';
my $current_directory = qx(pwd);
# Remove the newline character from the end of the output
chomp($current_directory);
$current_directory=$current_directory.$temp;

# Print the current directory path
print "Current directory: $current_directory\n";
# Specify the filename
my $filename = $current_directory.'/My Spotify Library.csv';
my @id;
my $id;
my $i = 0;
# Open the file for reading
open(my $fh, '<', $filename) or die "Could not open file '$filename' $!";
# Read the file line by line
while (my $line = <$fh>) {
    chomp($line);  # Remove the newline character at the end of the line
    # Split the line based on the specified character (comma in this case)
    my @strings = split(/,/, $line);
    # Print the separated strings
    my $songID = $strings[6];
    print "songID: $songID\n";
    $id[$i]=$songID;
    $i++;
}
# Close the file handle
close($fh);
my $spotifyURL;
my @spotifyURL;
my $URL = 'https://open.spotify.com/intl-de/track/';
for(my $i = 1; $i < $#id;$i++){
    push(@spotifyURL,$URL.$id[$i]);
}
my $func = 0;
foreach (@spotifyURL){
   my $hash =$_;
   $hash =~ tr/"//d;
   if(!system("spotdl download $hash")){
       next;
   }else{ my $i=0;
        while(!system("spotdl download $hash")){
            $i++;
            if ($i==25){
                 last;
            }else{ last;
            }
        }
    }
}
